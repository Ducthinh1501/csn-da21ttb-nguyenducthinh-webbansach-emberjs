<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MyProject2</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

      

    <link integrity="" rel="stylesheet" href="{{rootURL}}assets/vendor.css">
    <link integrity="" rel="stylesheet" href="{{rootURL}}assets/my-project-2.css">
    <link rel="stylesheet" type="text/css" href="base.css">  
    <script src="assets\js\vendor\modernizr-2.8.3.min.js"></script>
    {{content-for "head-footer"}}
  </head>
  <body>
    <body>

        
      <!-- header -->
      <header>
          <nav>
              <div class="img-nav">
                  <img src="logo" alt="" />
              </div>
              <div class="content-nav">
                  <ul>
                      <li><a href="#">Trang Chủ</a></li>
                      <li><a href="#">Sản Phẩm</a></li>
                      <li><a href="#">Liên Hệ</a></li>
                      <li><a href="#">Giới Thiệu</a></li>
                  </ul>
                  <div>
                      <input id="input-search"  type="text" name="search" placeholder="Tìm kiếm sản phẩm..." onkeypress="handleSearchProduct(event)"/>
                      <button type="submit"><i class="fa fa-search" aria-hidden="true"></i></button>
                  </div>
                  <!-- <form>
                      <input type="text" name="search" placeholder="Tìm kiếm sản phẩm..." />
                      <button type="submit"><i class="fa fa-search" aria-hidden="true"></i></button>
                  </form> -->
              </div>
              <!-- The Modal -->
              <button id="cart">
                  <i class="fa fa-shopping-basket" aria-hidden="true"></i>
                  Giỏ Hàng
              </button>
              <div id="myModal" class="modal">
                  <div class="modal-content">
                      <div class="modal-header">
                          <h5 class="modal-title">Giỏ Hàng</h5>
                          <span class="close">&times;</span>
                      </div>
                      <div class="modal-body">
                          <div class="cart-row">
                              <span class="cart-item cart-header cart-column">Sản Phẩm</span>
                              <span class="cart-price cart-header cart-column">Giá</span>
                              <span class="cart-quantity cart-header cart-column">Số Lượng</span>
                          </div>
                          <div id="container-product-cart"> 
                              
                          </div>
                          <div class="cart-total">
                              <strong class="cart-total-title">Tổng Cộng:</strong>
                              <span class="cart-total-price">0VNĐ</span>
                          </div>
                      </div>
  
                      <div class="modal-footer">
                          <button type="button" class="btn btn-secondary close-footer">Đóng</button>
                          <button type="button" class="btn btn-primary order">Thanh Toán</button>
                      </div>
                  </div>
              </div>
          </nav>

          <!-- content -->
    <section class="wrapper">
      <div class="products" id="container-products">
           
      </div>
  </section>

  <!-- footer -->
  <footer>
    <div class="footer-item">
        <div class="img-footer">
            <img src="/assets/imgs/logo.jpg" alt="" />
        </div>
        <div class="social-footer">
            <li><a target="_blank" href="#">
                    <i class="fa fa-facebook-square" aria-hidden="true"></i>
                </a></li>
            <li><a target="_blank" href="#">
                    <i class="fa fa-github-square" aria-hidden="true"></i>
                </a></li>

        </div>
    </div>
</footer>
  
      </header>

    <script src="{{rootURL}}assets/vendor.js">
    </script>
    <script src="{{rootURL}}assets/my-project-2.js"></script>

    <script>


        let products = [
            {
                id: 1,
                name: 'Đắc nhân tâm',
                price: 30000,
                thumbail_url: '/assets/imgs/dacnhantam.jpg'
            },
            {
                id: 2,
                name: 'Giao tiếp bất kì ai',
                price: 76000,
                thumbail_url: '/assets/imgs/giaotiepbatkyai.jpg'
            },
            {
                id: 3,
                name: 'Hành trình phương đông',
                price: 76000,
                thumbail_url: '/assets/imgs/hanhtrinhphuongdong.jpg'
            },
            {
                id: 4,
                name: 'Im lặng là bản năng',
                price: 36700,
                thumbail_url: '/assets/imgs/imlanglabannang.jpg'
            }
        ];




        handleRenderProductIntoPage();


        function handleRenderProductIntoPage() {
            let containerProduct = document.querySelector('#container-products');

            let productHTML = products.map(item => {
                return `
                    <li class="main-product">
                        <div class="img-product test">
                            <img class="img-prd"
                                src="${item.thumbail_url}"
                                alt="">
                        </div>
                        <div class="content-product">
                            <h3 class="content-product-h3">${item.name}</h3>
                            <div class="content-product-deltals">
                                <div class="price">
                                    <span class="money">${item.price}đ</span>
                                </div>
                                <button type="button" class="btn btn-cart"  onClick="handleAddCart(${item.id})">Thêm Vào Giỏ</button>
                            </div>
                        </div>
                    </li>
                `;
            })

            containerProduct.innerHTML = `<ul>${productHTML.join('')}</ul>`;
        }

        
        function handleAddCart(id_product_add_cart) { 
            let productInCart = JSON.parse(localStorage.getItem('cart')) ? JSON.parse(localStorage.getItem('cart')) : [];

            for (let i=0; i<products.length; i++) {
                if (products[i].id == id_product_add_cart) { 
                    let is_valid = true;
                    for (let j=0; j<productInCart.length; j++) {
                        if (id_product_add_cart == productInCart[j].id) {
                            is_valid = false;
                            break;
                        }
                    } 

                    if (is_valid)
                        productInCart.push(products[i]);
                }
                    
            }

            localStorage.setItem('cart', JSON.stringify(productInCart))
        }


        // document.querySelector('#input-search').keypress(function(event) {
        //     console.log(event);
        //     var keyword = event.keyCode ? event.keyCode : event.which;
        //     console.log(keyword);
        // })

        function handleSearchProduct(event) {
            let product_filler_search = [];
            if (event.key == 'Enter') {
                let key_word = document.querySelector("#input-search").value.trim();

                product_filler_search = products.filter(item => item.name.toLocaleLowerCase().indexOf(key_word.toLocaleLowerCase()) !== -1)

                let productHTML = product_filler_search.map(item => {
                    return `
                        <li class="main-product">
                            <div class="img-product test">
                                <img class="img-prd"
                                    src="${item.thumbail_url}"
                                    alt="">
                            </div>
                            <div class="content-product">
                                <h3 class="content-product-h3">${item.name}</h3>
                                <div class="content-product-deltals">
                                    <div class="price">
                                        <span class="money">${item.price}đ</span>
                                    </div>
                                    <button type="button" class="btn btn-cart"  onClick="handleAddCart(${item.id})">Thêm Vào Giỏ</button>
                                </div>
                            </div>
                        </li>
                    `;
                })

               
                let containerProduct = document.querySelector('#container-products');
    
                containerProduct.innerHTML = `<ul>${productHTML.join('')}</ul>`;
            }

        }


        // Modal
        var modal = document.getElementById("myModal");
        var btn = document.getElementById("cart");
        var close = document.getElementsByClassName("close")[0];
        // tại sao lại có [0] như  thế này bởi vì mỗi close là một html colection nên khi mình muốn lấy giá trị html thì phải thêm [0]. 
        // Nếu mình có 2 cái component cùng class thì khi [0] nó sẽ hiển thị component 1 còn [1] thì nó sẽ hiển thị component 2.
        var close_footer = document.getElementsByClassName("close-footer")[0];
        var order = document.getElementsByClassName("order")[0];
        btn.onclick = function () {
            modal.style.display = "block";

            let containerProductCart = document.querySelector('#container-product-cart');

            let productInCartHTML = JSON.parse(localStorage.getItem('cart')).map(item => {
                return `
                    <div class="cart-items">
                        <span class="cart-item cart-header cart-column">${item.name}</span>
                        <span class="cart-price cart-header cart-column">${item.price}</span>
                        <span class="cart-quantity cart-header cart-column">1</span>
                    </div> 
                `;
            });

            containerProductCart.innerHTML = productInCartHTML.join('');

        }
        close.onclick = function () {
            modal.style.display = "none";
        }
        close_footer.onclick = function () {
            modal.style.display = "none";
        }
        order.onclick = function () {
            alert("Cảm ơn bạn đã thanh toán đơn hàng")
        }
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>

    {{content-for "body-footer"}}
  </body>
</html>
